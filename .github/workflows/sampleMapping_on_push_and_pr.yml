on:
  push:
    branches: [ main, development ]
  pull_request:
    branches: [ main ]
env:
  SAMPLE_DATA_URL: https://matwerk.datamanager.kit.edu/api/v1/dataresources/e9611736-a4cb-4ed6-a91a-ddcce6700603/data/20230707_AlSi13_NFDI_renamed_folders.zip
  SAMPLE_MAP_URL: https://github.com/kit-data-manager/Metadata-Schemas-for-Materials-Science/blob/dfe04f53ecc8c55eea9ee29f183bacde7cdf3653/SEM-FIB_Tomography/sem_fib_nested_schema_Thermofisher_Helios_G4_PFIB_CXe_map.json
jobs:
  mapSample:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout repository
      uses: actions/checkout@v4

    - name: Set up Python
      uses: actions/setup-python@v5
      with:
        python-version: '3.12'

    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        pip install -r requirements.txt

    - name: Download sample data
      run: |
        curl -o sample_data.zip ${{ env.SAMPLE_DATA_URL }}

    - name: Download sample map file
      run: |
        curl -o map.json ${{ env.SAMPLE_MAP_URL }}

    - name: Run script
      run: |
        python metaMapper.py sample_data.zip result.json

    - name: Upload output as artifact
      uses: actions/upload-artifact@v4
      with:
        name: sample-mapping-output
        path: result.json